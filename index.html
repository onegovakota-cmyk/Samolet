<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catch the Right Answer</title>

<style>
html,body{
  margin:0;height:100%;
  background:#0b0b14;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:#fff;overflow:hidden;
}
#game{position:relative;width:100%;height:100%;}
#hud{
  position:absolute;top:0;left:0;right:0;
  padding:12px 16px;display:flex;justify-content:space-between;align-items:center;
  z-index:10;background:linear-gradient(to bottom, rgba(0,0,0,.6), transparent);
}
#question{font-weight:900;}
#stats{font-size:14px;opacity:.85;display:flex;gap:12px;align-items:center;}
#barWrap{
  width:180px;height:10px;border-radius:999px;
  background:rgba(255,255,255,.12);overflow:hidden;
}
#bar{height:100%;width:0%;background:rgba(120,90,255,.95);}
#scene{position:absolute;inset:0;overflow:hidden;}
.player{
  position:absolute;left:60px;top:50%;
  width:44px;height:44px;border-radius:50%;
  background:#7b4dff;transform:translateY(-50%);
  box-shadow:0 0 18px rgba(123,77,255,.5);
}
.answer{
  position:absolute;width:72px;height:72px;border-radius:50%;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-weight:900;font-size:20px;color:#000;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
  user-select:none;
}
.answer .t{font-size:11px;font-weight:800;opacity:.8;margin-top:2px}
.answer.correct{ background:#4cff9e; }
.answer.wrong{ background:#ff6b6b; }

#feedback{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  font-size:36px;font-weight:1000;pointer-events:none;opacity:0;
  transition:.22s;
}
#feedback.show{ opacity:1; }

#final{
  position:absolute;inset:0;background:rgba(0,0,0,.82);
  display:none;align-items:center;justify-content:center;flex-direction:column;
  gap:16px;z-index:20;text-align:center;padding:20px;
}
#final.show{ display:flex; }
button{
  padding:10px 16px;border-radius:12px;border:none;
  font-weight:900;cursor:pointer;
}
.small{font-size:12px;opacity:.75;max-width:560px;line-height:1.4}
</style>
</head>

<body>
<div id="game">
  <div id="hud">
    <div id="question"></div>
    <div id="stats">
      <div id="count"></div>
      <div id="lives"></div>
      <div id="barWrap"><div id="bar"></div></div>
    </div>
  </div>

  <div id="scene">
    <div class="player" id="player" title="‚¨Ü/‚¨á"></div>
  </div>

  <div id="feedback"></div>

  <div id="final">
    <h1 id="finalText"></h1>
    <div class="small" id="finalSub"></div>
    <button onclick="restart()">–ò–≥—Ä–∞—Ç—å –µ—â—ë</button>
  </div>
</div>

<script>
// ================= CONFIG (–ø–æ–¥ –±—É–¥—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä) =================
const GAME_CONFIG = {
  lives: 3,
  speed: 2.7,         // —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –≤–ª–µ–≤–æ
  playerSpeed: 7,     // —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä–æ–∫–∞ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑
  gapAfterHitMs: 550, // –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è (—Ñ–∏–¥–±–µ–∫)

  // –≤–æ–ø—Ä–æ—Å—ã: —Å–≤–µ—Ä—Ö—É —Ç–µ–∫—Å—Ç, –æ—Ç–≤–µ—Ç—ã A/B/C ‚Äî –∫–∞–∫ —Å–Ω–∏—Ç—á–∏
  questions: [
    {
      q: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?",
      answers: [
        { label:"A", text:"–ü–∞—Ä–∏–∂",  correct:true  },
        { label:"B", text:"–†–∏–º",    correct:false },
        { label:"C", text:"–ë–µ—Ä–ª–∏–Ω", correct:false }
      ]
    },
    {
      q: "2 + 2 = ?",
      answers: [
        { label:"A", text:"3", correct:false },
        { label:"B", text:"4", correct:true  },
        { label:"C", text:"5", correct:false }
      ]
    },
    {
      q: "–ì–¥–µ –±–æ–ª—å—à–µ: 7 –∏–ª–∏ 9?",
      answers: [
        { label:"A", text:"7", correct:false },
        { label:"B", text:"9", correct:true  },
        { label:"C", text:"—Ä–∞–≤–Ω—ã", correct:false }
      ]
    },
  ],
};
// =================================================================

const scene = document.getElementById("scene");
const player = document.getElementById("player");
const questionEl = document.getElementById("question");
const countEl = document.getElementById("count");
const livesEl = document.getElementById("lives");
const barEl = document.getElementById("bar");
const feedback = document.getElementById("feedback");
const final = document.getElementById("final");
const finalText = document.getElementById("finalText");
const finalSub = document.getElementById("finalSub");

let keys = {};
let raf = null;

// game state
let state = null;

function initState(){
  state = {
    qIndex: 0,
    lives: GAME_CONFIG.lives,
    score: 0,
    active: [],      // —Ç–µ–∫—É—â–∏–µ –ª–µ—Ç—è—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    locked: false,   // –±–ª–æ–∫–∏—Ä—É–µ–º –∫–æ–ª–ª–∏–∑–∏–∏ –≤–æ –≤—Ä–µ–º—è —Ñ–∏–¥–±–µ–∫–∞/–ø–µ—Ä–µ—Ö–æ–¥–∞
  };
}

function hearts(n){
  return "‚ù§Ô∏è".repeat(Math.max(0,n)) + (n<=0 ? "‚Äî" : "");
}

function updateHUD(){
  const total = GAME_CONFIG.questions.length;
  const current = Math.min(state.qIndex + 1, total);
  questionEl.textContent = (state.qIndex < total) ? GAME_CONFIG.questions[state.qIndex].q : "";
  countEl.textContent = `${Math.min(state.qIndex, total)}/${total} ‚úÖ ${state.score}`;
  livesEl.textContent = `–ñ–∏–∑–Ω–∏: ${hearts(state.lives)}`;
  const pct = total ? Math.round((Math.min(state.qIndex, total) / total) * 100) : 0;
  barEl.style.width = pct + "%";
}

function clearAnswers(){
  state.active.forEach(o => o.el.remove());
  state.active = [];
}

function spawnAnswersForQuestion(){
  clearAnswers();

  const q = GAME_CONFIG.questions[state.qIndex];
  // —Å–æ–∑–¥–∞—ë–º 3 ‚Äú—Å–Ω–∏—Ç—á–∞‚Äù –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–æ—Ä–æ–∂–∫–∞—Ö –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
  q.answers.forEach((a,i)=>{
    const el = document.createElement("div");
    el.className = "answer " + (a.correct ? "correct" : "wrong");

    const lab = document.createElement("div");
    lab.textContent = a.label;

    const t = document.createElement("div");
    t.className = "t";
    t.textContent = a.text;

    el.appendChild(lab);
    el.appendChild(t);

    el.dataset.correct = a.correct ? "1" : "0";
    el.style.left = (scene.clientWidth + 40) + "px";
    // 3 –ø–æ–ª–æ—Å—ã: 30%, 50%, 70% (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞—Ç—å —Ä–∞–Ω–¥–æ–º/–ø–∞—Ç—Ç–µ—Ä–Ω—ã)
    const lanes = [0.30, 0.50, 0.70];
    el.style.top = Math.round(scene.clientHeight * lanes[i % lanes.length]) + "px";
    el.style.transform = "translate(-50%,-50%)";
    scene.appendChild(el);

    state.active.push({ el, data:a, hit:false });
  });
}

function nextQuestion(){
  // –∫–æ–Ω–µ—Ü –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
  if(state.qIndex >= GAME_CONFIG.questions.length){
    endGame(true);
    return;
  }
  updateHUD();
  spawnAnswersForQuestion();
}

function showFeedback(text, ok){
  feedback.textContent = text;
  feedback.style.color = ok ? "#4cff9e" : "#ff6b6b";
  feedback.classList.add("show");
  setTimeout(()=>feedback.classList.remove("show"), GAME_CONFIG.gapAfterHitMs - 60);
}

function handleAnswer(correct){
  if(state.locked) return;
  state.locked = true;

  if(correct){
    state.score++;
    showFeedback("–°—É–ø–µ—Ä!", true);
  }else{
    state.lives--;
    // –≤–∏–∑—É–∞–ª—å–Ω—ã–π ‚Äú—à–æ–∫‚Äù
    scene.animate([{filter:"brightness(1)"},{filter:"brightness(.7)"},{filter:"brightness(1)"}], {duration:220});
    player.animate([{transform:"translateY(-50%)"},{transform:"translateY(-50%) translateX(-4px)"},{transform:"translateY(-50%)"}], {duration:220});
    showFeedback("–û—à–∏–±–∫–∞", false);
  }

  // —Å—Ä–∞–∑—É –∂–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É (–∫–∞–∫ –≤ —Ç–≤–æ—ë–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–∏)
  // –Ω–æ –¥–µ–ª–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ø–∞—É–∑—É, —á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ —É–≤–∏–¥–µ–ª —Ñ–∏–¥–±–µ–∫
  setTimeout(()=>{
    clearAnswers();
    if(state.lives <= 0){
      endGame(false);
      return;
    }
    state.qIndex++;
    state.locked = false;
    nextQuestion();
  }, GAME_CONFIG.gapAfterHitMs);
}

function checkCollision(obj){
  if(obj.hit || state.locked) return;

  const a = obj.el.getBoundingClientRect();
  const p = player.getBoundingClientRect();
  const overlap = !(a.right < p.left || a.left > p.right || a.bottom < p.top || a.top > p.bottom);

  if(overlap){
    obj.hit = true;
    obj.el.remove();
    const correct = obj.data.correct === true;
    handleAnswer(correct);
  }
}

function loop(){
  if(!state) return;

  // –¥–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  let top = player.offsetTop;
  if(keys.ArrowUp) top -= GAME_CONFIG.playerSpeed;
  if(keys.ArrowDown) top += GAME_CONFIG.playerSpeed;
  top = Math.max(0, Math.min(scene.clientHeight - player.clientHeight, top));
  player.style.top = top + "px";

  // –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ
  state.active.forEach(obj=>{
    const x = obj.el.offsetLeft - GAME_CONFIG.speed;
    obj.el.style.left = x + "px";

    // –µ—Å–ª–∏ —É–ª–µ—Ç–µ–ª–∏ –∑–∞ —ç–∫—Ä–∞–Ω ‚Äî —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –∏–≥—Ä–æ–∫ ‚Äú–ø—Ä–æ–ø—É—Å—Ç–∏–ª‚Äù (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ –Ω–∞–∫–∞–∑–∞–Ω–∏—è)
    if(x < -120 && !obj.hit){
      obj.hit = true;
      obj.el.remove();

      // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É ‚Äú–ø—Ä–æ–ø—É—Å–∫ = –æ—à–∏–±–∫–∞‚Äù
      // –°–µ–π—á–∞—Å ‚Äî –ø—Ä–æ—Å—Ç–æ –∂–¥—ë–º, –ø–æ–∫–∞ –∏–≥—Ä–æ–∫ –ø–æ–π–º–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.
    }

    checkCollision(obj);
  });

  raf = requestAnimationFrame(loop);
}

function endGame(win){
  state.locked = true;
  clearAnswers();
  updateHUD();

  final.classList.add("show");
  finalText.textContent = win ? "üéâ –ü–æ–±–µ–¥–∞!" : "üíÄ –ñ–∏–∑–Ω–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å";
  finalSub.textContent =
    `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${state.score}/${GAME_CONFIG.questions.length} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö.`;

  if(raf) cancelAnimationFrame(raf);
  raf = null;
}

function restart(){
  final.classList.remove("show");
  if(raf) cancelAnimationFrame(raf);
  raf = null;

  initState();
  // –ø–æ—Å—Ç–∞–≤–∏–º –∏–≥—Ä–æ–∫–∞ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É
  player.style.top = Math.round(scene.clientHeight/2) + "px";
  nextQuestion();
  loop();
}

// input
window.addEventListener("keydown", (e)=>{ keys[e.key]=true; });
window.addEventListener("keyup", (e)=>{ keys[e.key]=false; });

// start
initState();
player.style.top = "50%";
updateHUD();
nextQuestion();
loop();
</script>
</body>
</html>
