<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Catch the Right Answer</title>

<style>
html,body{
  margin:0;height:100%;
  background:#0b0b14;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:#fff;overflow:hidden;
}
#game{position:relative;width:100%;height:100%;}
#hud{
  position:absolute;top:0;left:0;right:0;
  padding:12px 16px;
  display:flex;justify-content:space-between;align-items:center;
  z-index:10;
  background:linear-gradient(to bottom, rgba(0,0,0,.65), transparent);
}
#question{font-weight:1000;max-width:70vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
#stats{font-size:14px;opacity:.9;display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:flex-end;}
#barWrap{
  width:180px;height:10px;border-radius:999px;
  background:rgba(255,255,255,.12);overflow:hidden;
}
#bar{height:100%;width:0%;background:rgba(120,90,255,.95);}
#scene{position:absolute;inset:0;overflow:hidden;}
.player{
  position:absolute;left:60px;top:50%;
  width:44px;height:44px;border-radius:50%;
  background:#7b4dff;transform:translateY(-50%);
  box-shadow:0 0 18px rgba(123,77,255,.55);
}
.answer{
  position:absolute;
  width:78px;height:78px;border-radius:50%;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-weight:1000;font-size:20px;color:#000;
  box-shadow:0 10px 25px rgba(0,0,0,.28);
  user-select:none;
}
.answer .t{font-size:11px;font-weight:900;opacity:.82;margin-top:2px;max-width:70px;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.answer.correct{ background:#4cff9e; }
.answer.wrong{ background:#ff6b6b; }

#feedback{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:36px;font-weight:1100;
  pointer-events:none;opacity:0;
  transition:.18s;
  z-index:15;
}
#feedback.show{ opacity:1; }

#final{
  position:absolute;inset:0;
  background:rgba(0,0,0,.82);
  display:none;align-items:center;justify-content:center;flex-direction:column;
  gap:16px;z-index:20;text-align:center;padding:20px;
}
#final.show{ display:flex; }
button{
  padding:10px 16px;border-radius:12px;border:none;
  font-weight:1000;cursor:pointer;
}
.small{font-size:12px;opacity:.75;max-width:560px;line-height:1.4}
</style>
</head>

<body>
<div id="game">
  <div id="hud">
    <div id="question"></div>
    <div id="stats">
      <div id="count"></div>
      <div id="lives"></div>
      <div id="barWrap"><div id="bar"></div></div>
    </div>
  </div>

  <div id="scene">
    <div class="player" id="player" title="‚¨Ü/‚¨á"></div>
  </div>

  <div id="feedback"></div>

  <div id="final">
    <h1 id="finalText"></h1>
    <div class="small" id="finalSub"></div>
    <button onclick="restart()">–ò–≥—Ä–∞—Ç—å –µ—â—ë</button>
  </div>
</div>

<script>
// ================= CONFIG (–ø–æ–¥ –±—É–¥—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä) =================
const GAME_CONFIG = {
  lives: 3,
  speed: 2.8,          // —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –≤–ª–µ–≤–æ
  playerSpeed: 7,      // —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä–æ–∫–∞ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑
  feedbackMs: 450,     // —Å–∫–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∏–¥–±–µ–∫ –ø–µ—Ä–µ–¥ —Å–º–µ–Ω–æ–π –≤–æ–ø—Ä–æ—Å–∞

  // –†–∞—Å–∫–ª–∞–¥–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤: —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (–Ω–µ –≤ –∫–æ–ª–æ–Ω–∫—É)
  layout: {
    paddingTop: 110,   // —á—Ç–æ–±—ã –Ω–µ –∑–∞–ª–µ–∑–∞–ª–∏ –ø–æ–¥ HUD
    paddingBottom: 40,
    minDistY: 95,      // –º–∏–Ω–∏–º—É–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –æ—Ç–≤–µ—Ç–∞–º–∏ –ø–æ Y
    startX: 80,        // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –∑–∞ –ø—Ä–∞–≤—ã–º –∫—Ä–∞–µ–º
    xSpreadMin: 90,    // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–Ω–æ—Å –ø–æ X –º–µ–∂–¥—É A/B/C
    xSpreadMax: 170,   // –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–Ω–æ—Å –ø–æ X –º–µ–∂–¥—É A/B/C
  },

  questions: [
    {
      q: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?",
      answers: [
        { label:"A", text:"–ü–∞—Ä–∏–∂",  correct:true  },
        { label:"B", text:"–†–∏–º",    correct:false },
        { label:"C", text:"–ë–µ—Ä–ª–∏–Ω", correct:false }
      ]
    },
    {
      q: "2 + 2 = ?",
      answers: [
        { label:"A", text:"3", correct:false },
        { label:"B", text:"4", correct:true  },
        { label:"C", text:"5", correct:false }
      ]
    },
    {
      q: "–ì–¥–µ –±–æ–ª—å—à–µ: 7 –∏–ª–∏ 9?",
      answers: [
        { label:"A", text:"7", correct:false },
        { label:"B", text:"9", correct:true  },
        { label:"C", text:"—Ä–∞–≤–Ω—ã", correct:false }
      ]
    },
  ],
};
// =================================================================

const scene = document.getElementById("scene");
const player = document.getElementById("player");
const questionEl = document.getElementById("question");
const countEl = document.getElementById("count");
const livesEl = document.getElementById("lives");
const barEl = document.getElementById("bar");
const feedback = document.getElementById("feedback");
const final = document.getElementById("final");
const finalText = document.getElementById("finalText");
const finalSub = document.getElementById("finalSub");

let keys = {};
let raf = null;

let state = null;

function initState(){
  state = {
    qIndex: 0,
    lives: GAME_CONFIG.lives,
    score: 0,
    active: [],          // –ª–µ—Ç—è—â–∏–µ –æ–±—ä–µ–∫—Ç—ã
    locked: false,       // –±–ª–æ–∫ –∫–æ–ª–ª–∏–∑–∏–∏ –Ω–∞ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ —Ñ–∏–¥–±–µ–∫–∞
    awaitingHit: true,   // –∂–¥—ë–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –æ–¥–∏–Ω –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤
  };
}

function hearts(n){
  return "‚ù§Ô∏è".repeat(Math.max(0,n)) + (n<=0 ? "‚Äî" : "");
}

function updateHUD(){
  const total = GAME_CONFIG.questions.length;
  const done = Math.min(state.qIndex, total);
  const pct = total ? Math.round((done / total) * 100) : 0;

  if(state.qIndex < total){
    questionEl.textContent = GAME_CONFIG.questions[state.qIndex].q;
  } else {
    questionEl.textContent = "";
  }

  countEl.textContent = `${done}/${total} ‚úÖ ${state.score}`;
  livesEl.textContent = `–ñ–∏–∑–Ω–∏: ${hearts(state.lives)}`;
  barEl.style.width = pct + "%";
}

function clearAnswers(){
  state.active.forEach(o => o.el.remove());
  state.active = [];
}

function randInt(a,b){
  return Math.floor(a + Math.random() * (b - a + 1));
}

function spawnAnswersForQuestion(){
  clearAnswers();
  state.awaitingHit = true;

  const q = GAME_CONFIG.questions[state.qIndex];
  const L = GAME_CONFIG.layout;

  const usedY = [];
  const startX = scene.clientWidth + L.startX;

  function pickY(){
    const minY = L.paddingTop;
    const maxY = scene.clientHeight - L.paddingBottom;

    for(let attempt=0; attempt<40; attempt++){
      const y = randInt(minY, maxY);
      const ok = usedY.every(prev => Math.abs(prev - y) >= L.minDistY);
      if(ok){
        usedY.push(y);
        return y;
      }
    }
    const fallback = randInt(minY, maxY);
    usedY.push(fallback);
    return fallback;
  }

  // –ø–µ—Ä–µ–º–µ—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã, —á—Ç–æ–±—ã A/B/C —Ç–æ–∂–µ –Ω–µ –≤—Å–µ–≥–¥–∞ –≤ –æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –ø–æ Y
  const shuffled = [...q.answers].sort(()=>Math.random()-0.5);

  shuffled.forEach((a,i)=>{
    const el = document.createElement("div");
    el.className = "answer " + (a.correct ? "correct" : "wrong");

    const lab = document.createElement("div");
    lab.textContent = a.label;

    const t = document.createElement("div");
    t.className = "t";
    t.textContent = a.text;

    el.appendChild(lab);
    el.appendChild(t);

    el.dataset.correct = a.correct ? "1" : "0";

    // ‚úÖ –†–∞–∑–Ω—ã–π —Å—Ç–∞—Ä—Ç –ø–æ X (–Ω–µ –∫–æ–ª–æ–Ω–∫–∞)
    const xOffset = i * randInt(L.xSpreadMin, L.xSpreadMax);
    el.style.left = (startX + xOffset) + "px";

    // ‚úÖ –°–ª—É—á–∞–π–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ø–æ Y, —Å –∞–Ω—Ç–∏-–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ–º
    el.style.top = pickY() + "px";
    el.style.transform = "translate(-50%,-50%)";

    scene.appendChild(el);
    state.active.push({ el, data:a, hit:false });
  });
}

function showFeedback(text, ok){
  feedback.textContent = text;
  feedback.style.color = ok ? "#4cff9e" : "#ff6b6b";
  feedback.classList.add("show");
  setTimeout(()=>feedback.classList.remove("show"), Math.max(120, GAME_CONFIG.feedbackMs - 80));
}

function goNextQuestionAfterFeedback(){
  // –∏–¥—ë–º –¥–∞–ª—å—à–µ, –ø–æ–∫–∞ –µ—Å—Ç—å –∂–∏–∑–Ω–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã
  state.qIndex++;
  if(state.lives <= 0){
    endGame(false);
    return;
  }
  if(state.qIndex >= GAME_CONFIG.questions.length){
    endGame(true);
    return;
  }
  state.locked = false;
  updateHUD();
  spawnAnswersForQuestion();
}

function handleAnswer(correct){
  if(state.locked) return;
  state.locked = true;
  state.awaitingHit = false;

  // –æ—á–∏—â–∞–µ–º –æ—Å—Ç–∞—Ç–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ ‚Äú–¥–æ–ª–µ—Ç–∞–ª–∏‚Äù
  clearAnswers();

  if(correct){
    state.score++;
    showFeedback("–°—É–ø–µ—Ä!", true);
  }else{
    state.lives--;
    // –ª—ë–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
    scene.animate([{filter:"brightness(1)"},{filter:"brightness(.72)"},{filter:"brightness(1)"}], {duration:220});
    player.animate(
      [{transform:"translateY(-50%)"},
       {transform:"translateY(-50%) translateX(-5px)"},
       {transform:"translateY(-50%) translateX(5px)"},
       {transform:"translateY(-50%)"}],
      {duration:220}
    );
    showFeedback("–û—à–∏–±–∫–∞", false);
  }

  updateHUD();

  // ‚úÖ –í–ê–ñ–ù–û: –∏–≥—Ä–∞ –ù–ï –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
  // –ü–æ—Å–ª–µ —Ñ–∏–¥–±–µ–∫–∞ (–∫–æ—Ä–æ—Ç–∫–∞—è –ø–∞—É–∑–∞) ‚Äî —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å.
  setTimeout(goNextQuestionAfterFeedback, GAME_CONFIG.feedbackMs);
}

function checkCollision(obj){
  if(obj.hit || state.locked) return;

  const a = obj.el.getBoundingClientRect();
  const p = player.getBoundingClientRect();
  const overlap = !(a.right < p.left || a.left > p.right || a.bottom < p.top || a.top > p.bottom);

  if(overlap){
    obj.hit = true;
    obj.el.remove();
    handleAnswer(obj.data.correct === true);
  }
}

function loop(){
  if(!state) return;

  // –¥–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  let top = player.offsetTop;
  if(keys.ArrowUp) top -= GAME_CONFIG.playerSpeed;
  if(keys.ArrowDown) top += GAME_CONFIG.playerSpeed;
  top = Math.max(0, Math.min(scene.clientHeight - player.clientHeight, top));
  player.style.top = top + "px";

  // –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ
  if(!state.locked){
    state.active.forEach(obj=>{
      const x = obj.el.offsetLeft - GAME_CONFIG.speed;
      obj.el.style.left = x + "px";
      checkCollision(obj);
    });
  }

  raf = requestAnimationFrame(loop);
}

function endGame(win){
  // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–∏–∫–ª–∞
  state.locked = true;
  clearAnswers();
  updateHUD();

  final.classList.add("show");
  finalText.textContent = win ? "üéâ –í–æ–ø—Ä–æ—Å—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!" : "üíÄ –ñ–∏–∑–Ω–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!";
  finalSub.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${state.score}/${GAME_CONFIG.questions.length} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö.`;

  if(raf) cancelAnimationFrame(raf);
  raf = null;
}

function restart(){
  final.classList.remove("show");
  if(raf) cancelAnimationFrame(raf);
  raf = null;

  initState();
  player.style.top = Math.round(scene.clientHeight/2) + "px";
  updateHUD();
  spawnAnswersForQuestion();
  loop();
}

// input
window.addEventListener("keydown", (e)=>{ keys[e.key]=true; });
window.addEventListener("keyup", (e)=>{ keys[e.key]=false; });

// start
initState();
player.style.top = "50%";
updateHUD();
spawnAnswersForQuestion();
loop();
</script>
</body>
</html>
